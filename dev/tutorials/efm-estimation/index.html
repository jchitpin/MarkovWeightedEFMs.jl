<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · MarkovWeightedEFMs.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MarkovWeightedEFMs.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Home</span><ul><li><a class="tocitem" href="../../">MarkovWeightedEFMs.jl</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Inputs"><span>Inputs</span></a></li><li><a class="tocitem" href="#Solving-for-EFM-sequences,-probabilities,-and-weights"><span>Solving for EFM sequences, probabilities, and weights</span></a></li><li><a class="tocitem" href="#Visualizing-the-Markov-chain"><span>Visualizing the Markov chain</span></a></li></ul></li><li><a class="tocitem" href="../../functions/cycle-history-markov-chain/">Functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jchitpin/MarkovWeightedEFMs.jl/blob/main/docs/src/tutorials/efm-estimation.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>This section shows how to use the functions in MarkovWeightedEFMs.jl on the following example network.</p><p><img src="../../assets/toy-network-1.png" alt="Note the network must be closed-loop and consist exclusively of unimolecular reactions"/></p><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>Given the metabolic network above, its steady state fluxes, and its elementary flux modes (EFMs), what is the set of EFM weights that reconstructs the observed network fluxes?</p><h2 id="Inputs"><a class="docs-heading-anchor" href="#Inputs">Inputs</a><a id="Inputs-1"></a><a class="docs-heading-anchor-permalink" href="#Inputs" title="Permalink"></a></h2><p>For this type of problem, we require the following:</p><ol><li>Stoichiometry matrix of unimolecular reactions (must be unimolecular, strongly-connected, and closed-loop!)</li><li>Steady state fluxes along each reaction.</li></ol><p>The network metabolites and reactions are typically encoded in an m by r stoichiometry matrix S. The steady state flux vector is stored as a separate vector.</p><pre><code class="language-julia hljs">using MarkovWeightedEFMs

S = [#
 -1  0  0  0  0  0  0  0  0  0  1
  1 -1  1 -1  0  0  0  0  0  0  0
  0  1 -1  0 -1  1  0  0  0  0  0
  0  0  0  1  0  0 -1  0  0  0  0
  0  0  0  0  1 -1  1 -1 -1  1  0
  0  0  0  0  0  0  0  1  0  0 -1
  0  0  0  0  0  0  0  0  1 -1  0
]
v = [3, 2, 1, 2, 3, 2, 2, 3, 1, 1, 3]</code></pre><p>We can check that the flux vector satisfies the steady state requirements.</p><pre><code class="language-julia hljs">all(S * v .== 0) # should evaluate as true</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><h2 id="Solving-for-EFM-sequences,-probabilities,-and-weights"><a class="docs-heading-anchor" href="#Solving-for-EFM-sequences,-probabilities,-and-weights">Solving for EFM sequences, probabilities, and weights</a><a id="Solving-for-EFM-sequences,-probabilities,-and-weights-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-for-EFM-sequences,-probabilities,-and-weights" title="Permalink"></a></h2><p>The following function applies our cycle-history (discrete-time) Markov chain method to compute the network EFMs, their steady state EFM probabilities, and weights. By default, the last parameter is 1 and can be omitted from the function. This parameter is the (arbitrary) initial state to root the cycle-history Markov chain. The choice of root state does not change the EFM probabilities or weights and is explained further in the section below.</p><pre><code class="language-julia hljs">efms = steady_state_efm_distribution(S, v, 1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(e = [[7, 5, 7], [6, 1, 2, 4, 5, 6], [3, 2, 3], [5, 3, 5], [3, 2, 4, 5, 3], [6, 1, 2, 3, 5, 6]], p = [0.14893617021276595, 0.25531914893617025, 0.10638297872340424, 0.2553191489361702, 0.0425531914893617, 0.19148936170212766], w = [1.0, 1.7142857142857144, 0.7142857142857143, 1.714285714285714, 0.28571428571428575, 1.2857142857142858])</code></pre><p>The enumerated EFM sequences are</p><pre><code class="language-julia hljs">efms.e</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Vector{Int64}}:
 [7, 5, 7]
 [6, 1, 2, 4, 5, 6]
 [3, 2, 3]
 [5, 3, 5]
 [3, 2, 4, 5, 3]
 [6, 1, 2, 3, 5, 6]</code></pre><p>The corresponding EFM probabilities are</p><pre><code class="language-julia hljs">efms.p</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Float64}:
 0.14893617021276595
 0.25531914893617025
 0.10638297872340424
 0.2553191489361702
 0.0425531914893617
 0.19148936170212766</code></pre><p>The corresponding EFM weights are</p><pre><code class="language-julia hljs">efms.w</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Float64}:
 1.0
 1.7142857142857144
 0.7142857142857143
 1.714285714285714
 0.28571428571428575
 1.2857142857142858</code></pre><p>Note: there is possibly an unexplained bug with the discrete-time Markov chain function <code>QuantEcon</code> package used to compute the steady state probabilities of each state. Sometimes, NaNs are returned from <code>steady_state_efm_distribution</code> and running the code again seems to return the proper solution.</p><p>We can check that the EFM weights reconstruct the observed network fluxes</p><pre><code class="language-julia hljs">E = reshape_efm_vector(efms.e, S) # matrix of EFM weights
E * efms.w ≈ v # passes</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>A binary EFM matrix with rows = # reactions and columns = # EFMs can be converted back to the array of EFM sequences by</p><pre><code class="language-julia hljs">reshape_efm_matrix(E, S)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Vector{Int64}}:
 [5, 7, 5]
 [1, 2, 4, 5, 6, 1]
 [2, 3, 2]
 [3, 5, 3]
 [3, 2, 4, 5, 3]
 [1, 2, 3, 5, 6, 1]</code></pre><h2 id="Visualizing-the-Markov-chain"><a class="docs-heading-anchor" href="#Visualizing-the-Markov-chain">Visualizing the Markov chain</a><a id="Visualizing-the-Markov-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-the-Markov-chain" title="Permalink"></a></h2><p>Our algorithm for computing EFM probabilities is to model steady state flux network as a cycle-history Markov chain. This is a discrete-time Markov chain of a certain transformed flux network. For further details, please read the accompanying paper in the Citation section. The network structure looks similar to a prefix tree although there exist certain upstream edges linking children to parent nodes. This network must be rooted on a starting metabolite, although the choice of root does not affect the final EFM probabilities. By default, index 1 is chosen as the root if this parameter is omitted. To visualize the transformed network:</p><pre><code class="language-julia hljs">using GLMakie # Makie backend
GLMakie.activate!()
T = stoich_to_transition(S, v) # transition probability matrix of the network
tree_plot(T, 1) # the last parameter is the rooted metabolite index</code></pre><p><img src="../../assets/toy-network-1-chmc-tree_plot.png" alt/></p><p>If using the GLMakie backend, ensure OpenGL is installed on your machine and accessible by Julia. The GLMakie plot is interactive and allows users to drag nodes and zoom in/out. Otherwise, you could choose another backend such as CairoMakie to generate and save a static plot. A prettier, hand-coded version of the transformed network is shown below.</p><p>The blue node is the root of the tree and the green nodes indicate that there is an edge back up to the root. By default, these arrows are omitted to avoid cluttering the plot.</p><p><img src="../../assets/toy-network-1-chmc.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« MarkovWeightedEFMs.jl</a><a class="docs-footer-nextpage" href="../../functions/cycle-history-markov-chain/">Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 19 June 2023 20:22">Monday 19 June 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
